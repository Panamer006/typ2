üîÅ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∑–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤)

–Ø –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é —á–∏—Å–ª–æ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ (–ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É 20). –ù—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å 2 —Ñ–∞–π–ª–∞ .mqh –∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤–∞—à SET_EURUSD_M15.set –Ω–∞ –≤–µ—Ä—Å–∏–∏ –Ω–∏–∂–µ.

1) typ_ccybias.mqh ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π (—É–±—Ä–∞–ª –¥—É–±–ª–∏—Ä—É—é—â–∏–π input, –¥–æ–±–∞–≤–∏–ª –¥–æ–º–∏–Ω–∞–Ω—Ç—É EUR/GBP)

–£–¥–∞–ª—ë–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π Bias_HardBlockInHARD (—Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ–º –∏–∑ TripleScreen).

–î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ Cross-dominance –ø–æ –∫—Ä–æ—Å—Å—É EURGBP (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã Bias_UseCrossDominance, Bias_Cross*).

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è CCYCrossBonusFor(symbol, dir) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–æ–Ω—É—Å/—à—Ç—Ä–∞—Ñ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [-1..+1] –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ —Å –¥–æ–º–∏–Ω–∞–Ω—Ç–æ–π EUR vs GBP.

–í—Å—Ç–∞–≤—å –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ typ_ccybias.mqh:

#ifndef __TYP_CCYBIAS_MQH__
#define __TYP_CCYBIAS_MQH__
#include "typ_core.mqh"

struct CCYBiasState { double S_base; double S_quote; double delta; bool dominant; };

input bool UseCCYBias=true;
input ENUM_TIMEFRAMES Bias_TF=PERIOD_H1;
input int Bias_Lookback=48;
input int Bias_SmoothEMA=5;
input bool Bias_UseZScore=true;
input double Bias_Threshold=0.6;
input double Bias_HeadwindPenalty=1.0;

// --- NEW: Cross-dominance (EUR vs GBP by EURGBP) ---
input bool Bias_UseCrossDominance=true;
input string Bias_CrossSymbol="EURGBP";
input ENUM_TIMEFRAMES Bias_CrossTF=PERIOD_H1;
input int Bias_CrossLookback=48;
input int Bias_CrossSmoothEMA=5;
input bool Bias_CrossZScore=true;
input double Bias_CrossThreshold=0.20; // significance threshold

string EUR_BASKET[]={"EURUSD","EURGBP","EURJPY","EURAUD","EURCAD","EURCHF","EURNZD"};
string USD_BASKET[]={"EURUSD","GBPUSD","USDJPY","AUDUSD","USDCAD","USDCHF","NZDUSD"};
string GBP_BASKET[]={"GBPUSD","EURGBP","GBPJPY","GBPAUD","GBPCAD","GBPCHF","GBPNZD"};
string JPY_BASKET[]={"USDJPY","EURJPY","GBPJPY","AUDJPY","CADJPY","CHFJPY","NZDJPY"};
string AUD_BASKET[]={"EURAUD","AUDUSD","AUDJPY","AUDCAD","AUDCHF","AUDNZD","GBPAUD"};
string CAD_BASKET[]={"USDCAD","EURCAD","GBPCAD","AUDCAD","CADJPY","CADCHF","NZDCAD"};
string CHF_BASKET[]={"USDCHF","EURCHF","GBPCHF","AUDCHF","CADCHF","CHFJPY","NZDCHF"};
string NZD_BASKET[]={"EURNZD","NZDUSD","NZDJPY","AUDNZD","NZDCAD","NZDCHF","GBPNZD"};

bool sym_exists(const string s){ return SymbolSelect(s,true); }

double pair_change_signed(const string sym,const string ccy,int lookback){
  if(!sym_exists(sym)) return 0.0;
  double p0=iClose(sym,Bias_TF,0), pL=iClose(sym,Bias_TF,lookback);
  if(p0<=0||pL<=0) return 0.0;
  double ch=(p0-pL)/pL;
  string base=StringSubstr(sym,0,3), quote=StringSubstr(sym,3,3);
  if(ccy==base) return +ch;
  if(ccy==quote) return -ch;
  return 0.0;
}

double basket_strength_raw(string ccy){
  string &B[]=(ccy=="EUR")?EUR_BASKET:(ccy=="USD")?USD_BASKET:(ccy=="GBP")?GBP_BASKET:(ccy=="JPY")?JPY_BASKET:(ccy=="AUD")?AUD_BASKET:(ccy=="CAD")?CAD_BASKET:(ccy=="CHF")?CHF_BASKET:NZD_BASKET;
  int n=ArraySize(B); if(n==0) return 0.0;
  double acc=0; int k=0;
  for(int i=0;i<n;i++){ double v=pair_change_signed(B[i], ccy, Bias_Lookback); if(v!=0){ acc+=v; k++; } }
  if(k==0) return 0.0;
  return acc/k;
}

double zscore_solo(double x){
  double s=(x==0?1e-6:fabs(x));
  double z=x/s;
  if(z>3) z=3; if(z<-3) z=-3;
  return z;
}

void split_symbol_bias(const string sym, string &base, string &quote){
  base=StringSubstr(sym,0,3); quote=StringSubstr(sym,3,3);
}

CCYBiasState BiasFor(const string sym){
  CCYBiasState st; st.S_base=0; st.S_quote=0; st.delta=0; st.dominant=false;
  if(!UseCCYBias) return st;
  string base,quote; split_symbol_bias(sym,base,quote);
  double Sb=basket_strength_raw(base), Sq=basket_strength_raw(quote);
  if(Bias_UseZScore){ Sb=zscore_solo(Sb); Sq=zscore_solo(Sq); }
  static double pb=0, pq=0; static bool init=false;
  double k=2.0/(MathMax(1,Bias_SmoothEMA)+1.0);
  double eb,eq;
  if(!init){ eb=Sb; eq=Sq; init=true; } else { eb = k*Sb + (1.0-k)*pb; eq = k*Sq + (1.0-k)*pq; }
  pb=Sb; pq=Sq;
  st.S_base=eb; st.S_quote=eq;
  st.delta=eb-eq;
  st.dominant=(MathAbs(st.delta)>=Bias_Threshold);
  return st;
}

// --- NEW: EUR vs GBP cross dominance via EURGBP ---
double __cross_delta_raw(){
  if(!Bias_UseCrossDominance) return 0.0;
  string cs=Bias_CrossSymbol; if(StringLen(cs)!=6) return 0.0;
  if(!sym_exists(cs)) return 0.0;
  double p0=iClose(cs, Bias_CrossTF, 0), pL=iClose(cs, Bias_CrossTF, Bias_CrossLookback);
  if(p0<=0||pL<=0) return 0.0;
  double ch=(p0-pL)/pL; // >0 => EUR stronger vs GBP
  if(Bias_CrossZScore) ch=zscore_solo(ch);
  static double prev=0; static bool init=false;
  double k=2.0/(MathMax(1,Bias_CrossSmoothEMA)+1.0);
  double sm = (init? (k*ch + (1.0-k)*prev) : ch);
  prev=sm; init=true;
  return sm;
}

// Return bonus in [-1..+1] for symbol+dir alignment with EUR/GBP cross dominance.
double CCYCrossBonusFor(const string sym, int dir){
  if(!Bias_UseCrossDominance || dir==0) return 0.0;
  double d = __cross_delta_raw(); // >0 EUR>GBP, <0 GBP>EUR
  if(MathAbs(d) < Bias_CrossThreshold) return 0.0; // not significant
  string base=StringSubstr(sym,0,3), quote=StringSubstr(sym,3,3);
  bool hasEUR=(base=="EUR"||quote=="EUR");
  bool hasGBP=(base=="GBP"||quote=="GBP");
  if(!(hasEUR||hasGBP)) return 0.0;

  double m = MathMin(1.0, MathAbs(d)/MathMax(1e-6, Bias_CrossThreshold));

  double sgn=0.0;
  if(hasEUR && !hasGBP){
    sgn = (d>0? +1.0 : -1.0);
    if(quote=="EUR") sgn = -sgn;
  } else if(hasGBP && !hasEUR){
    sgn = (d>0? -1.0 : +1.0);
    if(quote=="GBP") sgn = -sgn;
  } else {
    return 0.0; // EURGBP itself ‚Äî –∏–≥–Ω–æ—Ä
  }
  double align = (dir>0? sgn : -sgn);
  return align * m; // [-1..+1]
}

#endif

2) typ_triplescreen.mqh ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π (RSI/Stoch + –∫—Ä–æ—Å—Å-–¥–æ–º–∏–Ω–∞–Ω—Ç–∞)

–î–æ–±–∞–≤–∏–ª –≤–µ—Å–∞ TS_W_Cross –∏ —Ñ–ª–∞–≥ Cross_HardBlockInHARD.

–í TS_AllowDir() –≤ —Ä–µ–∂–∏–º–µ HARD –ø–æ—è–≤–∏–ª—Å—è –∂—ë—Å—Ç–∫–∏–π –±–ª–æ–∫ –ø–æ –∫—Ä–æ—Å—Å-–¥–æ–º–∏–Ω–∞–Ω—Ç–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω).

–í TS_ScoreDir() –¥–æ–±–∞–≤–ª–µ–Ω –±–æ–Ω—É—Å/—à—Ç—Ä–∞—Ñ TS_W_Cross * CCYCrossBonusFor(...).

–í—Å—Ç–∞–≤—å –≤–º–µ—Å—Ç–æ –≤–∞—à–µ–≥–æ typ_triplescreen.mqh:

#ifndef __TYP_TRIPLESCREEN_MQH__
#define __TYP_TRIPLESCREEN_MQH__

#include "typ_core.mqh"
#include "typ_ccybias.mqh"
#include "typ_force.mqh"
#include "typ_envelopes.mqh"

// --- –±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
input int              Trend_EMA_Period      = 200;
input TS_Mode          TS_ModeSetting        = TS_HARD;
input ENUM_TIMEFRAMES  TF_Trend              = PERIOD_H4;
input ENUM_TIMEFRAMES  TF_Setup              = PERIOD_H1;
input ENUM_TIMEFRAMES  TF_Trigger            = PERIOD_M15;

// Setup –∏—Å—Ç–æ—á–Ω–∏–∫–∏
input bool             Setup_UseDMA          = true;
input bool             Setup_UseTriangle     = true;

// DMA (–Ω–∞ Setup TF)
input int              Setup_DMA_MA_Period   = 34;
input ENUM_MA_METHOD   Setup_DMA_Method      = MODE_EMA;
input int              Setup_DMA_ATR_Period  = 14;
input double           Setup_DMA_TouchBuf_ATR= 0.20;
input double           Setup_DMA_BreakBuf_ATR= 0.25;

// Triangle (–Ω–∞ Setup TF)
input int              Setup_TRI_FractalDepth= 2;
input int              Setup_TRI_SearchWindow= 300;
input double           Setup_TRI_TouchBuf_ATR= 0.20;
input double           Setup_TRI_BreakBuf_ATR= 0.25;
input int              Setup_TRI_ATR_Period  = 14;

// --- —Ç—Ä–∏–≥–≥–µ—Ä—ã ---
input bool             UseForceTrigger       = true;
input bool             UseEnvelopesTrigger   = true;
input bool             Trigger_ANY           = true;

// NEW: RSI-—Ç—Ä–∏–≥–≥–µ—Ä
input bool             UseRSITrigger         = true;
input ENUM_TIMEFRAMES  RSI_TF                = PERIOD_M15;
input int              RSI_Period            = 14;
input double           RSI_LongLevel         = 55.0;
input double           RSI_ShortLevel        = 45.0;
input bool             RSI_UseCross          = true;

// NEW: Stochastic-—Ç—Ä–∏–≥–≥–µ—Ä
input bool             UseStochTrigger       = true;
input ENUM_TIMEFRAMES  Stoch_TF              = PERIOD_M15;
input int              Stoch_K               = 14;
input int              Stoch_D               = 3;
input int              Stoch_Slow            = 3;
input ENUM_MA_METHOD   Stoch_Method          = MODE_SMA;
input ENUM_STO_PRICE   Stoch_Price           = STO_LOWHIGH;
input bool             Stoch_UseLevelFilter  = true;
input double           Stoch_LowLevel        = 20.0;
input double           Stoch_HighLevel       = 80.0;

// --- —Å–∫–æ—Ä–∏–Ω–≥–æ–≤—ã–µ –≤–µ—Å–∞ (SOFT) ---
input double           TS_W_Trend            = 1.0;
input double           TS_W_Setup            = 1.0;
input double           TS_W_Trigger          = 1.0;
input double           TS_W_Conflict         = 1.0;
input double           TS_W_Headwind         = 1.0;
input double           TS_W_Cross            = 0.5;   // NEW
input double           TS_ScoreThreshold     = 2.0;

// --- HARD –±–ª–æ–∫–∏ ---
input bool             Bias_HardBlockInHARD  = true;
input bool             Cross_HardBlockInHARD = false; // NEW

// --- —Ö—ç–Ω–¥–ª—ã ---
int hEMA_trend = INVALID_HANDLE;
int hMA34_low  = INVALID_HANDLE, hMA34_high = INVALID_HANDLE, hMA34_close = INVALID_HANDLE;
int hATR_setup = INVALID_HANDLE;
int hFr        = INVALID_HANDLE;

int hRSI       = INVALID_HANDLE;
int hStoch     = INVALID_HANDLE;

double __tb(int h,int shift=0){ double a[]; if(CopyBuffer(h,0,shift,1,a)<1) return 0; return a[0]; }

void __ensure_setup(){
  if(hMA34_low  == INVALID_HANDLE)  hMA34_low  = iMA(_Symbol, TF_Setup, Setup_DMA_MA_Period, 0, Setup_DMA_Method, PRICE_LOW);
  if(hMA34_high == INVALID_HANDLE)  hMA34_high = iMA(_Symbol, TF_Setup, Setup_DMA_MA_Period, 0, Setup_DMA_Method, PRICE_HIGH);
  if(hMA34_close== INVALID_HANDLE)  hMA34_close= iMA(_Symbol, TF_Setup, Setup_DMA_MA_Period, 0, Setup_DMA_Method, PRICE_CLOSE);
  if(hATR_setup == INVALID_HANDLE)  hATR_setup = iATR(_Symbol, TF_Setup, Setup_DMA_ATR_Period);
  if(hFr        == INVALID_HANDLE)  hFr        = iFractals(_Symbol, TF_Setup);
}

// --- TREND ---
int trend_dir(){
  if(hEMA_trend==INVALID_HANDLE) hEMA_trend=iMA(_Symbol, TF_Trend, Trend_EMA_Period, 0, MODE_EMA, PRICE_CLOSE);
  double ema[2]; if(CopyBuffer(hEMA_trend,0,0,2,ema)<2) return 0;
  double p = iClose(_Symbol, TF_Trend, 0);
  if(p>ema[0] && ema[0]>ema[1]) return +1;
  if(p<ema[0] && ema[0]<ema[1]) return -1;
  return 0;
}

// --- SETUP: DMA ---
bool setup_dma_ok(int dir){
  if(!Setup_UseDMA) return false;
  __ensure_setup();
  double px  = iClose(_Symbol, TF_Setup, 0);
  double atr = __tb(hATR_setup,0); if(atr<=0) return false;
  double mL=__tb(hMA34_low,0), mH=__tb(hMA34_high,0), mC=__tb(hMA34_close,0);
  bool bounce_long  = (dir>0 && px<=mL+Setup_DMA_TouchBuf_ATR*atr);
  bool bounce_short = (dir<0 && px>=mH-Setup_DMA_TouchBuf_ATR*atr);
  bool broke_up     = (dir>0 && px> mC+Setup_DMA_BreakBuf_ATR*atr);
  bool broke_down   = (dir<0 && px< mC-Setup_DMA_BreakBuf_ATR*atr);
  return (bounce_long||bounce_short||broke_up||broke_down);
}

// --- SETUP: Triangle ---
bool last_two_fr(int buf_idx,int look,int &i1,double &p1,int &i2,double &p2){
  double b[]; ArraySetAsSeries(b,true);
  int need=look+50;
  if(CopyBuffer(hFr,buf_idx,0,need,b)<10) return false;
  int c=0;
  for(int i=1;i<need && c<2;i++){
    if(b[i]!=0.0){
      if(c==0){i1=i;p1=b[i];} else{ i2=i;p2=b[i]; }
      c++;
    }
  }
  return (c==2);
}
double line_p(double pA,int iA,double pB,int iB,int x=0){
  if(iA==iB) return pA;
  double a=(pA-pB)/(double)(iA-iB); double b=pA-a*iA;
  return a*x+b;
}

bool setup_triangle_ok(int dir){
  if(!Setup_UseTriangle) return false;
  __ensure_setup();
  double atrv[]; if(CopyBuffer(hATR_setup,0,0,1,atrv)<1) return false;
  double A=atrv[0]; if(A<=0) return false;
  int iu1,iu2,id1,id2; double pu1,pu2,pd1,pd2;
  if(!last_two_fr(0,Setup_TRI_SearchWindow,iu1,pu1,iu2,pu2)) return false;
  if(!last_two_fr(1,Setup_TRI_SearchWindow,id1,pd1,id2,pd2)) return false;
  double up=line_p(pu1,iu1,pu2,iu2,0), lo=line_p(pd1,id1,pd2,id2,0), px=iClose(_Symbol, TF_Setup, 0);
  bool near_up=(up>0 && (up-px)<=Setup_TRI_TouchBuf_ATR*A);
  bool near_lo=(lo>0 && (px-lo)<=Setup_TRI_TouchBuf_ATR*A);
  bool br_up  =(up>0 && px>up+Setup_TRI_BreakBuf_ATR*A);
  bool br_dn  =(lo>0 && px<lo-Setup_TRI_BreakBuf_ATR*A);
  if(dir>0) return (near_lo||br_up);
  if(dir<0) return (near_up||br_dn);
  return false;
}

// --- TRIGGER: RSI ---
int rsi_ready(){ if(hRSI==INVALID_HANDLE) hRSI=iRSI(_Symbol, RSI_TF, RSI_Period, PRICE_CLOSE); return hRSI; }
bool rsi_values(double &r0,double &r1){ if(rsi_ready()==INVALID_HANDLE) return false; double a[2]; if(CopyBuffer(hRSI,0,0,2,a)<2) return false; r0=a[0]; r1=a[1]; return true; }
bool RSI_TriggerOK(int dir){
  if(!UseRSITrigger) return true;
  double r0,r1; if(!rsi_values(r0,r1)) return false;
  if(RSI_UseCross){
    if(dir>0) return (r1<=RSI_LongLevel  && r0>RSI_LongLevel);
    if(dir<0) return (r1>=RSI_ShortLevel && r0<RSI_ShortLevel);
    return false;
  }else{
    if(dir>0) return (r0>RSI_LongLevel);
    if(dir<0) return (r0<RSI_ShortLevel);
    return false;
  }
}

// --- TRIGGER: Stochastic ---
int stoch_ready(){ if(hStoch==INVALID_HANDLE) hStoch=iStochastic(_Symbol, Stoch_TF, Stoch_K, Stoch_D, Stoch_Slow, Stoch_Method, Stoch_Price); return hStoch; }
bool stoch_values(double &k0,double &k1,double &d0,double &d1){
  if(stoch_ready()==INVALID_HANDLE) return false;
  double K[2],D[2];
  if(CopyBuffer(hStoch,0,0,2,K)<2) return false;
  if(CopyBuffer(hStoch,1,0,2,D)<2) return false;
  k0=K[0]; k1=K[1]; d0=D[0]; d1=D[1]; return true;
}
bool Stoch_TriggerOK(int dir){
  if(!UseStochTrigger) return true;
  double k0,k1,d0,d1; if(!stoch_values(k0,k1,d0,d1)) return false;
  if(dir>0){
    bool crossUp = (k1<=d1 && k0>d0);
    if(!crossUp) return false;
    if(Stoch_UseLevelFilter) return (MathMin(k0,k1) <= Stoch_LowLevel);
    return true;
  }
  if(dir<0){
    bool crossDn = (k1>=d1 && k0<d0);
    if(!crossDn) return false;
    if(Stoch_UseLevelFilter) return (MathMax(k0,k1) >= Stoch_HighLevel);
    return true;
  }
  return false;
}

// --- TRIGGER aggregator ---
bool trigger_ok(int dir){
  int enabled=0, ok=0;
  if(UseForceTrigger){ enabled++; if(Force_TriggerOK(dir)) ok++; }
  if(UseEnvelopesTrigger){ enabled++; if(Envelopes_TouchDir(dir,0)) ok++; }
  if(UseRSITrigger){ enabled++; if(RSI_TriggerOK(dir)) ok++; }
  if(UseStochTrigger){ enabled++; if(Stoch_TriggerOK(dir)) ok++; }
  if(enabled==0) return true;
  return (Trigger_ANY ? (ok>0) : (ok==enabled));
}

// --- SETUP aggregate ---
bool setup_ok(int dir){
  bool ok=false;
  if(Setup_UseDMA)      ok |= setup_dma_ok(dir);
  if(Setup_UseTriangle) ok |= setup_triangle_ok(dir);
  return ok;
}

// --- HARD gate ---
bool TS_AllowDir(int dir){
  if(TS_ModeSetting!=TS_HARD) return true;
  int tr = trend_dir();
  if(tr!=dir)                 return false;
  if(!setup_ok(dir))          return false;
  if(!trigger_ok(dir))        return false;

  if(Bias_HardBlockInHARD){
    CCYBiasState b=BiasFor(_Symbol);
    if(dir==+1 && b.delta<0)  return false;
    if(dir==-1 && b.delta>0)  return false;
  }
  if(Cross_HardBlockInHARD){
    double bonus = CCYCrossBonusFor(_Symbol, dir);
    if(bonus < 0.0) return false; // –∑–Ω–∞—á–∏–º—ã–π –≤—Å—Ç—Ä–µ—á–Ω—ã–π —Å–∏–≥–Ω–∞–ª –æ—Ç EUR/GBP –¥–æ–º–∏–Ω–∞–Ω—Ç—ã
  }
  return true;
}

// --- SOFT scoring ---
double TS_ScoreDir(int dir){
  if(TS_ModeSetting!=TS_SOFT) return 0.0;
  double sc=0.0;
  int tr = trend_dir();
  if(tr==dir)     sc += TS_W_Trend;
  else if(tr==-dir) sc -= TS_W_Conflict;
  if(setup_ok(dir))   sc += TS_W_Setup;
  if(trigger_ok(dir)) sc += TS_W_Trigger;

  CCYBiasState b=BiasFor(_Symbol);
  if( (dir==+1 && b.delta<0) || (dir==-1 && b.delta>0) )
    sc -= TS_W_Headwind;

  // NEW: –±–æ–Ω—É—Å/—à—Ç—Ä–∞—Ñ –æ—Ç EUR/GBP –¥–æ–º–∏–Ω–∞–Ω—Ç—ã
  double bonus = CCYCrossBonusFor(_Symbol, dir); // [-1..+1]
  sc += TS_W_Cross * bonus;

  return sc;
}

#endif

3) SET_EURUSD_M15.set ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π (RSI/Stoch + Cross)

–ó–∞–º–µ–Ω—è–µ—Ç –≤–∞—à —Å—Ç–∞—Ä—ã–π –ø—Ä–µ—Å–µ—Ç (–∏–º—è —Ç–æ –∂–µ). –°—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–µ—Ä–µ:

; Updated for v2.0.1 ‚Äî includes RSI/Stoch and cross-dominance
Magic=68001
DryRun=false
TradeTF=M15
MaxSpreadPts=25
TS_ModeSetting=0
TF_Trend=H4
TF_Setup=H1
TF_Trigger=M15

Trigger_ANY=true

UseForceTrigger=true
Force_TF=M15
Force_PeriodEMA=13
Force_MinAbs=0.0
Force_RequireCross=true
Force_SignInTrend=true

UseEnvelopesTrigger=true
Env_TF=M15
Env_Period=34
Env_Method=MODE_EMA
Env_DeviationPcnt=0.8
Env_AppliedPrice=PRICE_CLOSE
Env_TouchTolerancePts=10

UseRSITrigger=true
RSI_TF=M15
RSI_Period=14
RSI_LongLevel=55.0
RSI_ShortLevel=45.0
RSI_UseCross=true

UseStochTrigger=true
Stoch_TF=M15
Stoch_K=14
Stoch_D=3
Stoch_Slow=3
Stoch_Method=MODE_SMA
Stoch_Price=STO_LOWHIGH
Stoch_UseLevelFilter=true
Stoch_LowLevel=20.0
Stoch_HighLevel=80.0

Setup_UseDMA=true
Setup_DMA_MA_Period=34
Setup_DMA_Method=MODE_EMA
Setup_DMA_ATR_Period=14
Setup_DMA_TouchBuf_ATR=0.20
Setup_DMA_BreakBuf_ATR=0.25

Setup_UseTriangle=true
Setup_TRI_FractalDepth=2
Setup_TRI_SearchWindow=300
Setup_TRI_TouchBuf_ATR=0.20
Setup_TRI_BreakBuf_ATR=0.25
Setup_TRI_ATR_Period=14

UseCCYBias=true
Bias_TF=H1
Bias_Lookback=48
Bias_SmoothEMA=5
Bias_UseZScore=true
Bias_Threshold=0.6
Bias_HeadwindPenalty=1.0

; Cross-dominance EUR/GBP
Bias_UseCrossDominance=true
Bias_CrossSymbol=EURGBP
Bias_CrossTF=H1
Bias_CrossLookback=48
Bias_CrossSmoothEMA=5
Bias_CrossZScore=true
Bias_CrossThreshold=0.20

; HARD flags
Bias_HardBlockInHARD=false
Cross_HardBlockInHARD=false

; Weights
TS_W_Trend=1.0
TS_W_Setup=1.0
TS_W_Trigger=1.0
TS_W_Conflict=1.0
TS_W_Headwind=1.0
TS_W_Cross=0.5
TS_ScoreThreshold=2.0

; Filters
UseTradingHours=true
TradeHours=08:00-22:00
FridayCutoff=20:00
UseSpreadStat=true
SpreadLookback=200
SpreadSigmaK=2.0
UseATRPercentile=true
ATR_Perc_Lookback=600
ATR_Perc_Min=30
UseCHOP=true
CHOP_Period=14
CHOP_MaxForTrend=55.0
UseADX=true
ADX_Period=14
ADX_Min=18.0
UseRegime=true
RegimeHysteresisBars=5

NewsCSV_Enabled=true
NewsCSV_Filename=news.csv
NewsCSV_TimeOffsetMin=0
News_PreMin=15
News_PostMin=30
News_MinImpact=Medium
News_FilterBySymbol=true

; Order Engine
TTL_Bars=6
MinRepricePts=5
QueueRetest=true
ReverseOnBreak=true
OE_DefaultLots=0.00
OE_Risk_Percent=0.7
OE_Risk_FromPlannedSL=true
OE_Risk_ATRmultFallback=1.0
OE_UseEquityInsteadOfBalance=true

; DMA exec
DMA_TF=PERIOD_CURRENT
DMA_UseTrendMA=true
DMA_TrendTF=H1
DMA_MA1_Period=200
DMA_MA1_Method=MODE_EMA
DMA_MA1_Price=PRICE_CLOSE
DMA_MA2_Period=34
DMA_MA2_Method=MODE_EMA
DMA_ATR_Period=14
DMA_TouchBuf_ATR=0.20
DMA_BreakBuf_ATR=0.25
DMA_RetestBuf_ATR=0.20
DMA_SL_ATR=0.35
DMA_UseBreakStop=false
DMA_StopExtraPts=5

; Triangle exec
TRI_TF=PERIOD_CURRENT
TRI_FractalDepth=2
TRI_SearchWindow=400
TRI_TouchBuf_ATR=0.20
TRI_BreakBuf_ATR=0.25
TRI_RetestBuf_ATR=0.20
TRI_SL_ATR=0.35
TRI_UseBreakStop=false
TRI_StopExtraPts=5

; PM
PM_Enabled=true
PM_PartialTPs=true
PM_TP1_R=1.0
PM_TP2_R=2.0
PM_TP3_R=3.0
PM_TP1_ClosePct=0.33
PM_TP2_ClosePct=0.33
PM_TP3_ClosePct=0.34
PM_MoveBE_AfterTP1=true
PM_BE_OffsetPts=2
PM_ATRTrail_AfterTP2=true
PM_ATR_Period=14
PM_ATR_Mult=1.5


–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è GBPUSD / USDJPY / XAUUSD, —è —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –∫–æ–Ω—Ñ–∏–≥–∏ (–º—ã –∏—Ö –≤—Å—Ç–∞–≤–ª—è–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–π —á–∞—Å—Ç–∏). –ú–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å –∏—Ö –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ .set —Ñ–∞–π–ª—ã –ø–∞–∫–µ—Ç–æ–º, –Ω–æ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –º—ã –Ω–µ —Ä–∞–∑–¥—Ä–∞–∫–æ–Ω—è–µ–º ‚Äî –¥–æ–±–∞–≤–∏–º –∏—Ö –∫–∞–∫ ¬´Extras¬ª (–æ—Ç–¥–µ–ª—å–Ω—ã–º –∞—Ä—Ö–∏–≤–æ–º), —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏–º–∏—Ç 20 —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—Ä–æ—Å—Å-–¥–æ–º–∏–Ω–∞–Ω—Ç–∞ EUR/GBP (–∫–æ—Ä–æ—Ç–∫–æ)

–°—á–∏—Ç–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ EURGBP –∑–∞ Bias_CrossLookback (H1), —Å–≥–ª–∞–∂–∏–≤–∞–µ–º EMA –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –±–µ—Ä—ë–º z-score.

–ï—Å–ª–∏ delta > 0 ‚Üí EUR —Å–∏–ª—å–Ω–µ–µ GBP (–µ–≤—Ä–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç), delta < 0 ‚Üí —Ñ—É–Ω—Ç –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç.

–î–ª—è –ø–∞—Ä —Å EUR: –ø—Ä–∏ delta>0 –ª–æ–Ω–≥–∏ –ø–æ–ª—É—á–∞—é—Ç +–±–æ–Ω—É—Å, —à–æ—Ä—Ç—ã ‚Äî —à—Ç—Ä–∞—Ñ; –ø—Ä–∏ delta<0 –Ω–∞–æ–±–æ—Ä–æ—Ç.

–î–ª—è –ø–∞—Ä —Å GBP: –∑–µ—Ä–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –µ–≤—Ä–æ —Å–∏–ª—å–Ω–µ–µ, GBP —Å–ª–∞–±–µ–µ ‚Üí –ª–æ–Ω–≥–∏ GBP-–ø–∞—Ä —Ö—É–∂–µ, —à–æ—Ä—Ç—ã –ª—É—á—à–µ).

–í HARD –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å Cross_HardBlockInHARD=true, —á—Ç–æ–±—ã —Å–¥–µ–ª–∫–∏ ¬´–ø—Ä–æ—Ç–∏–≤¬ª –¥–æ–º–∏–Ω–∞–Ω—Ç—ã —Ä—É–±–∏–ª–∏—Å—å –Ω–∞ –≤—Ö–æ–¥–µ.

–í SOFT —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç/—É–±–∏—Ä–∞–µ—Ç —Å–∫–æ—Ä–∏–Ω–≥–æ–≤—ã–π –≤–µ—Å TS_W_Cross (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.5).

–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç-—á–µ–∫

–ó–∞–º–µ–Ω–∏—Ç—å 2 —Ñ–∞–π–ª–∞ (typ_ccybias.mqh, typ_triplescreen.mqh), –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ—Å–µ—Ç SET_EURUSD_M15.set.

–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å TakeYourProfitEA2.mq5 ‚Äî –±–µ–∑ –æ—à–∏–±–æ–∫/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.

–í ¬´–°–≤–æ–π—Å—Ç–≤–∞—Ö —ç–∫—Å–ø–µ—Ä—Ç–∞¬ª –≤–∏–¥–Ω—ã –Ω–æ–≤—ã–µ –∏–Ω–ø—É—Ç—ã: –±–ª–æ–∫ RSI/Stoch –∏ –±–ª–æ–∫ Cross-dominance.

–í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω EURUSD M15:

–í–∫–ª—é—á–∏/–≤—ã–∫–ª—é—á–∏ Bias_UseCrossDominance –∏ –ø–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —á–∞—Å—Ç–æ—Ç–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤.

–î–ª—è —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –ø–æ–ø—Ä–æ–±—É–π Cross_HardBlockInHARD=true.

–ú–∏–Ω–∏-—á–µ–∫-–ª–∏—Å—Ç (–æ—Å—Ç–∞—Ç–∫–∏/–≥–æ—Ç–æ–≤–æ)

–ì–æ—Ç–æ–≤–æ:

‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π typ_triplescreen.mqh —Å RSI/Stoch –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∫—Ä–æ—Å—Å-–¥–æ–º–∏–Ω–∞–Ω—Ç—ã

‚úÖ –ü–∞—Ç—á typ_ccybias.mqh (–±–µ–∑ –¥—É–±–ª—è input) + —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–º–∏–Ω–∞–Ω—Ç—ã EUR/GBP

‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω SET_EURUSD_M15.set –ø–æ–¥ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É

–û—Å—Ç–∞–ª–æ—Å—å (—Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏):

‚óªÔ∏è –î–æ–±–∞–≤–∏—Ç—å ¬´Extras¬ª –ø—Ä–µ—Å–µ—Ç—ã (GBPUSD_STRICT, USDJPY_SOFT, XAUUSD_ATR) –∞—Ä—Ö–∏–≤–æ–º –≤–Ω–µ –∫–æ—Ä–Ω—è

‚óªÔ∏è –ü—Ä–æ–≥–Ω–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π WFO –∏ –ø–æ–¥–æ–≥–Ω–∞—Ç—å TS_W_Cross, Bias_CrossThreshold –ø–æ —Å–∏–º–≤–æ–ª–∞–º

‚óªÔ∏è –í–∫–ª—é—á–∏—Ç—å –¥–Ω–µ–≤–Ω–æ–π risk-–∫–æ–Ω—Ç—É—Ä (–ª–∏–º–∏—Ç—ã –ø–æ —É–±—ã—Ç–∫—É/—Å–¥–µ–ª–∫–∞–º)

‚óªÔ∏è –î–æ–∫–∏–Ω—É—Ç—å —Å–∫—Ä–∏–Ω—ã/FAQ –≤ README –¥–ª—è —Ä–µ–ª–∏–∑–∞ Market

–ì–æ—Ç–æ–≤ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–∞–∫ ¬´Extras¬ª –ø—Ä–µ—Å–µ—Ç–æ–≤ –æ—Ç–¥–µ–ª—å–Ω—ã–º –∞—Ä—Ö–∏–≤–æ–º –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É —Ä–∏—Å–∫-–∫–æ–Ω—Ç—É—Ä—É –∏–ª–∏ –¥–∞–ª—å—à–µ —É–≥–ª—É–±–ª—è—Ç—å –º–µ–∂–≤–∞–ª—é—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, USD-–¥–æ–º–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ DXY –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –±–æ–Ω—É—Å/—à—Ç—Ä–∞—Ñ).