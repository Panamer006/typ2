*** Begin Patch
*** Add File: .cursorrules
+include: ["Experts", "Indicators", "Files", "docs", "prompts"]
+exclude: [".git", ".github", ".venv", "build", "dist", "__pycache__", "MQL5/Logs", "MQL5/Profiles"]
+notes:
+  - "Старт читать с docs/INDEX.md, затем docs/ARCHITECTURE.md"
+  - "Для изменений кода выдавай unified diff (единый патч)"
+
*** End Patch

*** Begin Patch
*** Add File: docs/INDEX.md
+# Документация проекта (TYP2)
+
+**Для всех ИИ-чатов и людей:** используйте этот индекс как входную точку.
+
+- [ARCHITECTURE.md](./ARCHITECTURE.md) — текущая архитектура EA (с учётом завершённого Спринта 2) и TODO.
+- [PROCESS_GIT.md](./PROCESS_GIT.md) — как мы работаем с ветками `main` (локально) и `dev` (удалённо), PR-поток.
+- [ROLES.md](./ROLES.md) — роли ИИ-чатов и правила ответа.
+- [tech_specs/](./tech_specs/) — ТЗ по задачам спринтов.
+
+> NB: Код менять только через **unified diff** в PR из `feature/*` → `dev` (Squash & Merge).
+
*** End Patch

*** Begin Patch
*** Add File: docs/ARCHITECTURE.md
+# Архитектура TYP2 (состояние: после Спринта 2)
+
+## Цель
+EA для MT5 (MQL5) с модульной структурой, расширяемой библиотекой сигналов и чётким риск-движком.
+
+## Целевое дерево
+```
+Experts/TYP2/
+  TakeYourProfit2.mq5           # главный модуль EA
+  core/                         # жизненный цикл, параметры, init/deinit
+  trade/                        # обёртки CTrade, открытие/закрытие, безопасные вызовы
+  risk/                         # размер лота, SL/TP, дневные стопы и лимиты
+  signals/                      # библиотека сигналов (MA, RSI, ATR guard и т.д.)
+  utils/                        # логгер, время, проверки, хелперы
+tests/presets/                  # .set файлы для тестера (по инструментам/ТФ)
+```
+
+## Главные потоки
+- **OnInit**: загрузка параметров (`input`), инициализация логгера/торговых классов, проверка окружения.
+- **OnTick**: вычисление сигналов → проверка риск-лимитов → торговое действие через `trade/*`.
+- **OnDeinit**: корректное завершение, закрытие ресурсов, финальный лог.
+
+## Минимальные параметры (референс)
+- `LotsMode` (Fixed/Percent), `RiskPercent`, `SLp`, `TPp`, `Magic`, `EnableTrailing`, `MaxDailyLoss`.
+
+## Требования к коду
+- Ошибки `CTrade` — проверяются и логируются.
+- Изменения бизнес-логики — только по ТЗ в `docs/tech_specs/`.
+- В PR — прикладывать результат тестера (лог/скрин) для ключевых фич.
+
+## TODO (следующие спринты)
+- Расширение `signals/*` (RSI-filter, ATR-guard).
+- Улучшение дневных лимитов и журналирования в `risk/*`.
+- Набор пресетов по основным парам/ТФ в `tests/presets/`.
+
*** End Patch

*** Begin Patch
*** Add File: docs/PROCESS_GIT.md
+# Процесс Git (локальная `main` ↔ удалённая `dev`)
+
+## Ветки
+- **Удалённая основная:** `dev` — только через PR (**Squash & Merge**), прямые пуши запрещены.
+- **Локальная база:** `main` — чистая копия `origin/dev`.
+- **Рабочие ветки:** `feature/T2-<кратко>` — каждая задача отдельно.
+
+## Быстрый цикл
+```bash
+git checkout main
+git pull origin dev
+git checkout -b feature/T2-<кратко>
+...работа...
+git add .
+git commit -m "feat(scope): T2-<кратко> ..."
+git push -u origin feature/T2-<кратко>
+# PR: feature → dev (Squash & Merge)
+```
+
+## Аварийно
+```bash
+git fetch origin
+git reset --hard origin/dev    # привести локальное состояние к dev
+git restore .                  # отменить незакоммиченное
+```
+
*** End Patch

*** Begin Patch
*** Add File: docs/ROLES.md
+# Роли ИИ-чатов (минимум ручного вмешательства)
+
+## 1) Architect (Проектировщик)
+- Анализирует структуру проекта и ТЗ.
+- Отвечает **только планом и схемами** (без кода).
+
+## 2) Codegen (Код-агент)
+- Пишет **только unified diff** (единый патч) для MQL5/инфраструктуры.
+- Обязателен раздел «Проверка компиляции» и список тестовых сценариев.
+
+## 3) Reviewer (Ревьюер)
+- Проверяет дифф: корректность, риски, перфоманс, стиль, недостающие тесты.
+- Отвечает чек-листом и конкретными замечаниями по строкам/файлам.
+
+## 4) PM / Scribe (Документация)
+- Обновляет `docs/*`, `tech_specs/*`, ROADMAP (без изменения кода).
+
+> Общие правила ответов для всех ролей см. в `prompts/roles/*`.
+
*** End Patch

*** Begin Patch
*** Add File: docs/tech_specs/README.md
+# Технические задания (TYP2)
+Каждая задача оформляется отдельным файлом: `docs/tech_specs/T2-<ID>.md`.
+Структура: цель → критерии готовности → артефакты → риски → ссылки на PR.
+
*** End Patch

*** Begin Patch
*** Add File: prompts/README.md
+# Промпты для мульти-чатов
+Используйте соответствующий файл роли из `prompts/roles/`.  
+**Важно:** для изменений кода используем **только unified diff**. Не правьте бизнес-логику без явного ТЗ.
+
*** End Patch

*** Begin Patch
*** Add File: prompts/roles/architect.md
+# ROLE: Architect (Проектировщик)
+Контекст: проект TYP2 (MQL5), см. docs/ARCHITECTURE.md.
+Задача: выдать план изменения архитектуры и файл-план без кода.
+Формат ответа:
+1) Цель задачи (1–3 пункта)
+2) План изменений (список файлов/модулей)
+3) Риски/зависимости
+4) Критерии готовности (Definition of Done)
+
*** End Patch

*** Begin Patch
*** Add File: prompts/roles/codegen.md
+# ROLE: Codegen (Код-агент)
+Контекст: проект TYP2 (MQL5), см. docs/ARCHITECTURE.md и docs/tech_specs/.
+Правила:
+- Возвращай **единый unified diff** (---/+++/@@) для всех файлов.
+- Код должен компилироваться без ошибок/варнингов.
+- Проверяй и логируй ошибки `CTrade`.
+- Бизнес-правила меняй только по ТЗ.
+Формат ответа:
+1) Короткий план изменений (список файлов)
+2) **Единый DIFF** (никаких отдельных фрагментов)
+3) Проверка: как компилировал/что проверить в тестере
+
*** End Patch

*** Begin Patch
*** Add File: prompts/roles/reviewer.md
+# ROLE: Reviewer (Ревьюер)
+Контекст: ревью диффа PR.
+Фокус: корректность, безопасность, перфоманс, стиль, недостающие тесты.
+Формат ответа (Markdown):
+- Critical: …
+- Performance: …
+- Tests to add: …
+- Style/Consistency: …
+- Notes by file/line: …
+
*** End Patch

*** Begin Patch
*** Add File: prompts/roles/pm.md
+# ROLE: PM / Scribe (Док-агент)
+Контекст: поддержка `docs/*`, `tech_specs/*`, ROADMAP.
+Формат ответа:
+1) Какие файлы обновить/создать
+2) Содержимое файлов (Markdown), без изменения кода
+3) Список открытых вопросов/зависимостей
+
*** End Patch
