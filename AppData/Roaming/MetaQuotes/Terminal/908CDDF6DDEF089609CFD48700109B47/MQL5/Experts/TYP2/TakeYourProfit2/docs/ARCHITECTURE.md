# TYP2 System Architecture

## 1. Ключевые модули
- **CRegimeEngine**  определяет режим рынка (рыночное состояние/фазы).
- **CRiskManager**  контроль допустимых рисков, лимитов и параметров капитала.
- **CExecGate**  финальный фильтр допуска сделки к исполнению (гвард).
- **CPositionManager**  учёт, сопровождение и обновление состояния позиций.
- **CChartObjectsManager** — управление графическими объектами/слоями.
- **CPatterns / CFigures / CFibo** — библиотеки технического анализа *(Sprint 2)*.
- **CStrategy_* ** — модули торговых стратегий *(Sprint 2)*.

## 2. Главные потоки данных
### OnInit()
Инициализация глобальных объектов и связей между ними.

### OnTick()
1. g_ChartManager.OnTickStart()
2. g_RegimeEngine.Update()
3. g_RiskManager.OnTick()
4. g_PosManager.OnTick()
5. **Гварды:** g_RiskManager.IsRiskOK(), g_ExecGate.IsExecutionAllowed()
6. **Генерация сигналов (Sprint 2):** g_Strategy_*.GetSignal()
7. **Исполнение:** 	rade.Buy/Sell(...), g_PosManager.AddNewPosition(...)
8. g_ChartManager.OnTickEnd()

## 3. Стыковки и принципы
- Стратегии читают состояние из Regime/Risk/Pos, выдают структурированный сигнал.
- Любое исполнение проходит через гварды Risk + ExecGate.
- ChartManager ответственен за визуальные артефакты (начало/конец тика — единая рамка).
- TA-библиотеки (Patterns/Figures/Fibo) — изолируемые, предпочтительно stateless-API.

## 4. Роадмап ↔ архитектура
- **Sprint 1 / 1.5 (Завершены):** шасси, безопасность, базовая визуализация.
- **Sprint 2 (Текущий):** TA-библиотеки + стратегии на существующем каркасе.
- **Sprint 3 (План):** трендовая стратегия + Resolver.
- **Sprint 4 (План):** тестирование, оптимизация, интеграция AI.

## 5. Стандарты кода (кратко)
- Имена классов: C* (пример: CRegimeEngine), инклуды 	yp_*.mqh.
- CStrategy_*::GetSignal() возвращает типизированный сигнал (тип/приоритет/обоснование/SL/TP/валидность).
- Гварды — обязательный барьер перед любым исполнением.
