# Протокол Тестирования и Оптимизации TYP2 ("Закалка Стали")

## 1. Миссия

Превратить полнофункциональный MVP в робастную, статистически проверенную и готовую к боевому применению торговую систему.

## 2. Этапы Работы

### **Этап 1: Верификация Логики (Визуальное Тестирование)**

*   **Цель:** Убедиться, что все модули работают **именно так, как мы их задумали.** Мы ищем не прибыльность, а корректность логики.
*   **Инструмент:** Тестер Стратегий MT5 в режиме **"Визуализация"**.
*   **Период:** Короткие, но характерные участки истории (сильный тренд, явный флэт, новостные "штормы").
*   **Чек-лист для Проверки:**
    1.  **`Regime Engine`:**
        *   [ ] Отображается ли текущий режим на Информационной Панели?
        *   [ ] Соответствует ли определяемый режим (`TREND`, `FLAT`) визуальной картине на графике?
        *   [ ] Корректно ли включается `RISK_OFF` на данных глобальных шоков (например, март 2020)?
    2.  **"Глаза" (`TA Libraries`):**
        *   [ ] Корректно ли отрисовываются фигуры ("Голова и Плечи", "Флаг")?
        *   [ ] Обнаруживаются и подсвечиваются ли свечные паттерны на D1/H4?
    3.  **`Resolver`:**
        *   [ ] В логах, почему был пропущен очевидный сигнал? (Найти примеры работы правил "Матрицы Конфликтов").
        *   [ ] В логах, почему был принят сигнал? (Найти примеры работы правил "Матрицы Конфлюэнса").
    4.  **`Position Manager`:**
        *   [ ] Корректно ли срабатывает `Tiered BE` (Этап 1 и Этап 2)?
        *   [ ] Правильно ли рассчитывается объем для `TP1`, `TP2`?
        *   [ ] Корректно ли работает логика **"Контекстного Освобождения Риска"** для доливок?

### **Этап 2: Поиск Оптимальных Параметров (Оптимизация в MQL5 Cloud Network)**

*   **Цель:** Найти не "идеальные", а **широкие, стабильные "плато"** оптимальных параметров.
*   **Инструмент:** Тестер Стратегий MT5 с использованием **MQL5 Cloud Network**.
*   **Период:** Длинный участок истории (например, 2-3 года).
*   **Метрика Оптимизации:** `Complex Criterion Max` (встроенная метрика, учитывающая и прибыльность, и надежность).
*   **Ключевые Группы Параметров для Оптимизации:**
    1.  **`Regime Engine`:** Пороги `ADX`, `CHOP`.
    2.  **Стратегии:** Периоды МА, каналов; порог `score` для `NightMR`.
    3.  **`Resolver`:** "Веса" (коэффициенты) для ключевых правил "Матрицы".
    4.  **`Position Manager`:** Множители ATR для SL и трейлинга; уровни в R для `Tiered BE` и `Сетки ТП`.

### **Этап 3: Проверка на Робастность (Walk-Forward Оптимизация)**

*   **Цель:** Убедиться, что найденные параметры не являются "подгонкой под историю" и стабильны во времени.
*   **Инструмент:** Встроенный в MT5 режим "Walk Forward".
*   **Период:** Вся доступная история, разбитая на шаги.
*   **Конфигурация WFO (Пример):**
    *   **Тип:** Rolling (плавающее окно).
    *   **In-Sample (Оптимизация):** 12 месяцев.
    *   **Out-of-Sample (Тест "вслепую"):** 3 месяца.
*   **Критерий Успеха:** Стабильная, восходящая кривая эквити на **всех** Out-of-Sample участках.

## 3. Финальные Артефакты

По итогам Спринта 4 у нас должны быть:
1.  **Несколько `.set` файлов** с робастными, проверенными на WFO наборами настроек для разных инструментов/стилей торговли (например, "EURUSD_H1_Balanced", "GBPUSD_H1_Aggressive").
2.  **Полный отчет о Walk-Forward тестах**, подтверждающий статистическое преимущество системы.
3.  **Финальная версия Информационной Панели**, отображающая всю ключевую информацию.